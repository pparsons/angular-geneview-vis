!function(t,e){t.margin={top:35,left:14,right:5};var r=248956422,n=1217e5,i=function(){this._segment="1",this._domTarget=e.select(document.documentElement),this._resolution="550",this._width=1e3,this._height=17,this._svgHeight=75,this._useRelative=!0,this._showAxis=!1,this.dispatch=e.dispatch("bandclick","selectorchange","selectorend"),this.rendered=!1,this.selectors=[],this.model=[],this.maxBasePair=0};i.prototype.getMaxBasepair=function(){return this.maxBasePair},i.prototype.segment=function(e){return"number"==typeof e&&(e=e.toString()),t.InitGetterSetter.call(this,"_segment",e)},i.prototype.target=function(r){if("string"==typeof r&&(r=e.select(r)),r.empty())throw"Error: Invalid dom target";return t.InitGetterSetter.call(this,"_domTarget",r)},i.prototype.resolution=function(e){return"number"==typeof e&&(e=e.toString()),t.InitGetterSetter.call(this,"_resolution",e)},i.prototype.width=function(e){return t.InitGetterSetter.call(this,"_width",e)},i.prototype.height=function(e){return t.InitGetterSetter.call(this,"_height",e)},i.prototype.useRelative=function(e){return t.InitGetterSetter.call(this,"_useRelative",e)},i.prototype.showAxis=function(e){return t.InitGetterSetter.call(this,"_showAxis",e)},i.prototype.on=function(t,e){if(!this.dispatch.hasOwnProperty(t))throw"Error: No event for "+t;this.dispatch.on(t,e)},i.prototype.config=function(t,e){return this[t](e)},i.prototype.renderAxis=function(){var r=e.svg.axis().scale(this.xscale).tickFormat(e.format("s")).orient("bottom");!this._useRelative||"Y"!==this._segment&&"22"!==this._segment&&"21"!==this._segment&&"20"!==this._segment&&"19"!==this._segment||r.ticks(6);var n=this.svgTarget.append("g").classed("bp-axis",!0).attr("transform","translate("+t.margin.left+","+(this._height+t.margin.top+5)+")");n.call(r),n.selectAll("text").style("font","10px sans-serif"),n.selectAll("path, line").style({fill:"none",stroke:"#666666","shape-rendering":"crispEdges"})},i.prototype.remove=function(){this.svgTarget.remove()},i.prototype.moveSelectorTo=function(t,e){if(2!==arguments.length)throw"Error moveSelectorTo: Invalid number of arguments. Both start and stop coordinates are required";0===this.selectors.length?this.newSelector(0,"10000000"):this.selectors[0].move(t,e)},i.prototype.newSelector=function(e,r){function n(t){var e=i.selectors.indexOf(t);i.selectors.splice(e,1)}var i=this,s=t.selector(n).x(t.margin.left).y(t.margin.top-this._height/4).height(this._height+this._height/2).xscale(this.xscale).extent([e,r]).target(this.svgTarget).render();s.dispatch.on("change",function(t){i.dispatch.selectorchange(t)}),s.dispatch.on("changeend",function(t){i.dispatch.selectorend(t)}),this.selectors.push(s)},i.prototype.getSelections=function(){for(var t=[],e=0;e<this.selectors.length;e++){var r=this.selectors[e].extent();t.push({start:r[0],stop:r[1]})}return t},i.prototype.getSelectedBands=function(t){var e=[];if(this.selectors.length>0){var r=this.selectors[0].extent(),n=+r[0],i=+r[1];"undefined"!=typeof t&&(n-=t,i+=t),e=this.model.slice().filter(function(t){var e=+t.bp_start,r=+t.bp_stop;return n>=e&&r>n||i>e&&r>=i||e>=n&&i>=r?!0:!1})}return e},i.prototype.getSVGTarget=function(){return this.svgTarget},i.prototype.render=function(){var i=this;return i.rendered&&i.remove(),t.modelLoader.load(this._segment,this._resolution,function(s){function o(e){var r=0;return i.alignCentromere&&"1"!==i._segment&&(r=i.xscale(n)-i.xscale(i.segMid)),i.xscale(e)+t.margin.left+r}i.model=s,i.maxBasePair=e.max(s,function(t){return+t.bp_stop}),i.segMid=0;for(var a=0;a<s.length;a++)if("acen"===s[a].stain){i.segMid=s[a].bp_stop;break}var h=i._useRelative?i.maxBasePair/r*i._width:i._width;i.xscale=e.scale.linear().domain([1,i.maxBasePair]).range([0,h-t.margin.left]);var c=i.alignCentromere?i._width+.3*i._width:i._width,l=i._height+58,u=c+t.margin.right+t.margin.right;i.svgTarget=i._domTarget.style("height",l+"px").style("width",u+5+"px").append("svg").attr("width",u).attr("height",l);var p=i.svgTarget.selectAll("g").data(s).enter();i.svgTarget.append("text").text(i._segment).attr("x",5).attr("y",t.margin.top+i._height/2+2).attr("text-anchor","middle").style("font","10px sans-serif"),p.append("g").each(function(r,n){function a(){this.attr("stroke","#000000").attr("stroke-width",.2)}function h(e,r,n,s,a,h){return this.append("path").attr("d",t.roundedRect(o(e.bp_start),t.margin.top,o(e.bp_stop)-o(e.bp_start),i._height,r,n,s,a,h)).style("fill",t.getStainColour(e.stain,e.density))}var c=e.select(this);if(n%2===0){var l=(o(r.bp_stop)+o(r.bp_start))/2;c.append("line").attr("x1",l).attr("y1",t.margin.top).attr("x2",l).attr("y2",t.margin.top-4).style("stroke","grey").style("stroke-width",1),c.append("text").attr("transform","translate("+l+","+(t.margin.top-6)+")rotate(-50)").style("font","10px sans-serif").text(r.arm+r.band)}var u,p=o(r.bp_stop)-o(r.bp_start);if(0===n&&p>10)u=h.call(c,r,4,!0,!1,!0,!1),a.call(u);else if("acen"===r.stain&&p>6)"p"===r.arm?u=h.call(c,r,5,!1,!0,!1,!0):"q"===r.arm&&(u=h.call(c,r,5,!0,!1,!0,!1));else if(n===s.length-1)u=h.call(c,r,5,!1,!0,!1,!0),a.call(u);else{var d="stalk"===r.stain?t.margin.top+i._height/4:t.margin.top,g="stalk"===r.stain?i._height/2:i._height;u=c.append("rect").attr("x",o(r.bp_start)).attr("y",d).attr("height",g).attr("width",i.xscale(r.bp_stop)-i.xscale(r.bp_start)).style("fill",t.getStainColour(r.stain,r.density)),a.call(u)}u.append("title").text(r.arm+r.band),u.on("mouseover",function(r){var n=e.select(this).style("opacity","0.5").style("cursor","pointer");"gneg"===r.stain&&n.style("fill",t.getStainColour("gpos","25"))}),u.on("mouseout",function(r){var n=e.select(this).style("opacity","1").style("cursor","default");"gneg"===r.stain&&n.style("fill",t.getStainColour("gneg"))}),u.on("click",function(t){(0===i.selectors.length||e.event.shiftKey)&&i.newSelector(t.bp_start,t.bp_stop),i.dispatch.bandclick(t)})}),i._showAxis&&i.renderAxis(),i.rendered=!0}),i},t.chromosome=function(){return new i}}(window.cyto_chr=window.cyto_chr||{},d3),function(t,e){function r(){this.status="notloaded",this.cache=[]}function n(t,r,n){var i=h[r];if(0===i.cache.length){if("loading"===i.status)return void c.push({res:r,cb:n});"notloaded"===i.status&&(i.status="loading",e.tsv(t,function(t){for(i.cache=t,i.status="loaded",n(t);c.length>0;){var e=c.shift();e.cb(t)}}))}else n(i.cache)}function i(t,e,r){t=t||"1",e=e||"550";var i=o[e];n(a+i,e,function(e){if(e){var n=s(e,t);r(n)}})}function s(t,e){for(var r=[],n=0;n<t.length;n++)t[n]["#chromosome"]===e&&r.push(t[n]);return r}var o={400:"ideogram_9606_GCF_000001305.14_400_V1",550:"ideogram_9606_GCF_000001305.14_550_V1",850:"ideogram_9606_GCF_000001305.14_850_V1",1200:"ideogram_9606_GCF_000001305.13_1200_v1"},a="data/",h={400:new r,550:new r,850:new r,1200:new r},c=[];t.modelLoader={load:i,setDataDir:function(t){a=t},getDataDir:function(){return a}}}(window.cyto_chr=window.cyto_chr||{},d3),function(t,e){var r=function(t){this._brush=e.svg.brush(),this.dispatch=e.dispatch("change","changeend"),this._x=0,this._y=0,this._extent=[0,0],this._height=0,this._closecb=t};r.prototype.test=function(e){var r=this;return t.InitGetterSetter.call(this,"_test",e,function(){r._another="_that"})},r.prototype.extent=function(e){var r=this;return"undefined"==typeof e?r._brush.extent():t.InitGetterSetter.call(this,"_extent",e,function(){r._brush.extent(e)})},r.prototype.xscale=function(e){var r=this;return t.InitGetterSetter.call(this,"_xscale",e,function(){r._brush.x(e)})},r.prototype.target=function(e){return t.InitGetterSetter.call(this,"_target",e)},r.prototype.height=function(e){return t.InitGetterSetter.call(this,"_height",e)},r.prototype.x=function(e){return t.InitGetterSetter.call(this,"_x",e)},r.prototype.y=function(e){return t.InitGetterSetter.call(this,"_y",e)},r.prototype.render=function(){var r=this;this.selector=this._target.append("g").attr("transform","translate("+this._x+","+this._y+")").call(this._brush),this.selector.selectAll("rect").attr("height",this._height),this.selector.select(".background").remove();var n=(this.selector.select(".extent").style("fill","steelblue").style("opacity","0.5"),this._xscale(this._extent[1])+t.margin.left),i=t.margin.top-3,s=this._target.append("g");return s.append("title").text("remove"),this.deleteButton=s.append("circle").attr("cx",n).attr("cy",i).attr("r",5).attr("fill","red").on("mouseover",function(){e.select(this).style("cursor","pointer")}).on("mouseout",function(){e.select(this).style("cursor","default")}).on("click",function(){r.remove()}),this._brush.on("brush",function(){r.updateXButton();var t=r._brush.extent();r.dispatch.change(t)}),this._brush.on("brushend",function(t){var e=r._brush.extent();r.dispatch.changeend(e)}),this},r.prototype.remove=function(){return this.selector.remove(),this.deleteButton.remove(),this._closecb(this),this},r.prototype.updateXButton=function(){var e=this._brush.extent(),r=this._xscale(e[1])+t.margin.left;this.deleteButton.attr("cx",r)},r.prototype.move=function(t,e){this._brush.extent([t,e]),this.selector.call(this._brush),this.updateXButton()},t.selector=function(t){return new r(t)}}(window.cyto_chr=window.cyto_chr||{},d3),function(t,e){t.initPattern=function(){var t=this.append("pattern").attr("id","acen-fill").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","10").attr("height","10").append("g").style({fill:"none",stroke:"#708090","stroke-width":"2"});t.append("path").attr("d","M0,0 l10,10"),t.append("path").attr("d","M10,0 l-10,10")},t.roundedRect=function(t,e,r,n,i,s,o,a,h){var c;return c="M"+(t+i)+","+e,c+="h"+(r-2*i),o?c+="a"+i+","+i+" 0 0 1 "+i+","+i:(c+="h"+i,c+="v"+i),c+="v"+(n-2*i),h?c+="a"+i+","+i+" 0 0 1 "+-i+","+i:(c+="v"+i,c+="h"+-i),c+="h"+(2*i-r),a?c+="a"+i+","+i+" 0 0 1 "+-i+","+-i:(c+="h"+-i,c+="v"+-i),c+="v"+(2*i-n),s?c+="a"+i+","+i+" 0 0 1 "+i+","+-i:(c+="v"+-i,c+="h"+i),c+="z"},t.getStainColour=function(t,e){if("gpos"===t){if(""===e||null===e)return"#000000";switch(e){case"100":return"#000000";case"75":return"#666666";case"50":return"#999999";case"25":return"#d9d9d9"}}return"gneg"===t?"#ffffff":"acen"===t?"#708090":"gvar"===t?"#e0e0e0":"stalk"===t?"#708090":"green"},t.setOption=function(t,e){return"undefined"!=typeof t?t:e},t.InitGetterSetter=function(t,e,r){return"undefined"!=typeof e?(this[t]=e,"function"==typeof r&&r(),this):this[t]}}(window.cyto_chr=window.cyto_chr||{},d3),function(){"undefined"!=typeof angular&&(cyto_chr.modelLoader.setDataDir("./node_modules/cyto-chromosome-vis/data/"),angular.module("cyto-chromosome-vis",[]).directive("cytochromosome",[function(){function t(t,e,r){r.resolution=cyto_chr.setOption(r.resolution,"550"),r.width=cyto_chr.setOption(r.width,1e3),r.segment=cyto_chr.setOption(r.segment,"1"),r.useRelative=cyto_chr.setOption(r.useRelative,!0),r.showAxis=cyto_chr.setOption(r.showAxis,!1),console.log(r),cyto_chr.chromosome().target(d3.select(e[0])).width(r.width).segment(r.segment).resolution(r.resolution).useRelative("true"==r.useRelative).showAxis("true"==r.showAxis).render()}return{link:t,restrict:"E"}}]).provider("cytochromosome",function(){this.build=function(){return cyto_chr.chromosome()},this.setDataDir=function(t){cyto_chr.modelLoader.setDataDir(t)},this.$get=function(){return this}}))}();